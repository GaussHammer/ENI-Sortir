{% extends 'base.html.twig' %}

{% block title %}New Sortie{% endblock %}

{% block body %}
    <h1>Create new Sortie</h1>

    {{ form_start(form)}}
        {{ form_widget(form) }}
        <p>Campus: {{ app.user.campus.nom }}</p>

        <button class="btn">{{ button_label|default('Save') }}</button>
    {{ form_end(form) }}
    <a href="{{ path('app_lieu_new') }}"><button>Ajouter un nouveau lieu: </button></a>
    <a href="{{ path('app_sortie_index') }}">back to list</a>

    <script>
        window.onload = () => {
            let ville = document.querySelector("#sortie_ville");

            ville.addEventListener("change", function(){

                fetch(
                    'http://localhost:8000/api/lieux/' + this.value
                )

                .then(response => response.json())
                .then(json => {
                    const lieux = document.querySelector('#sortie_lieu');
                    lieux.innerHTML="";
                    json.map(lieu=>{
                        lieux.innerHTML+=`<option value="${lieu.id}">${lieu.nom}</option>`
                    })
                })

                .catch(error => {
                    console.log(error);
                })

            });
        };
    </script>
{% endblock %}
